# 全志在线社区中的哪吒D1开发板 

开源软件在社区中的应用及玩法

来到全志科技实习已经将近三个月了，我所做的工作主要是参与维护全志在线开发者社区，利用我们开放的SDK 和开放的升级包，去做自己想要做的事情，并将它进行实现，同时在参与在线社区的运营中，我也认识了更多的小伙伴，同时在自己开发的过程中，我也了解了Tina SDK中开发的常用流程。
从以下几个方面入手开始介绍在这三个月中全志在线社区的发展状况，同时汇报我的工作情况。
- 社区介绍
  - 社区内容
	这是我们社区目前的主题模块的分布情况，有文档，专题详情，精华推荐，还有开源的资料下载，当然还有我们上线不久的微信公众号。
  - 社区成员
    - 全志在线社区 bbs.aw-ol.com 通过D1芯片吸引了来自不同社区不同领域对RISCV感兴趣的伙伴。不论是RiSCV中文社区还是国外媒体，均对我们的Allwinner D1芯片有多报道，这也是我们宣传基础的一部分。这些开发者们抱着不同的需求来到社区，其中最多的需求是为了解决问题，这也就意味着我们们社区色问题载体越多，解决的问题越多，流量也会越来越多，这是一个量变到质变的过程。
  - 社区主题
    - 作为一个交流技术的论坛，此时不得不谈谈社区主题分布。以及社区的作用，我们大多数人来逛社区应该都是想解决问题，或者只是简单的看看，只有少数或者极少数开发者愿意主动分享。此时作为全志在线的东道主。我们更应该注重社区开源方向和氛围的把控。
- 开发实例
  - 全志在线官方给出的功能和建议
    全志在线提供了从硬件设计到软件SDK以及工具链等手册和代码SDK。不论是系统生态还是软件生态现在都再有条不紊的建立起来。作为一个开发板，什么是尤为重要的？那肯定是芯片拥有的能力家软件提供的接口和便捷性和易用性都是极为重要的！但这些我们的社区全都有！
  - 底层玩家
	现在的社区中有 韦老师的Buildroot 一键构建启动镜像 也有 nihui 的 ncnn 边缘推理框架的优化  同时也有其他开发者为哪吒做的外壳  扩展板等 。 底层玩家喜欢将芯片摸个遍，从芯片的寄存器到构建自己的系统，这些玩家喜欢完完整整的掌握这块芯片。   
	这是网友为哪吒做的JTAG调试转接板，配合上平头哥的CKLink可以使用GDB调试开发板寄存器。还有网友手撸汇编，优化编译器的编译代码，这就是ncnn 作者nihui。ncnn 大家应该都比较陌生，所以我在这里多一些介绍ncnn 的篇幅，ncnn 是一个为手机端（移动端）或者 理解 为边缘端 极致优化的 高性能神经网络前向计算框架。  有网友 评论： 对我而言，开源且方便移植，我只服ncnn，他是一个没有任何第三方依赖，跨平台的第三方推理库，目前已知的系统又 Windows Linux  Andriod 包括 X86 ARM RISCV等架构均支持，他的功能也很丰富，支持 。。。。。 而且速度块体积小，可扩展 兼容性好，反正很强就对了！
	
- 经典案例
	作者创建ncnn 也是有这样的考虑，目前没有一个像样的手机端的优化框架，一般是各家掌握着自己家的框架和优化技术及方案，好不夸张的说，在开源软件中应该是没有第二个了！
	这里是ncnn 测优化在AllWinnerD1上测试的优化的耗时比数据。可以看到最低有7倍的优化效率，最高优化了70倍！ncnn作者发表 ncnn 携手全志科技，共同打通了AI应用和国产cpu硬件见的壁垒。
	韦老师的buildroot也在nezha上进行了适配，buildroot现在支持一键构建哪吒启动镜像。可以直接烧录SD卡启动，同时buildroot支持了很多第三方的软件包。
	中国科学大学的团队也为我们的平台进行了openEuler的适配openEuler是华为发起的开源操作系统，支持了华为鲲鹏计算生态。
有了上面的来自于社区和系统的供应，不同的开发者也有自己熟悉的平台和功能，那么软件开发者就基于我们的操作系统有针对性的开发了如下好玩的东西。
  - 软件玩家
	这些是我们网友贡献中的一些剪影，分别是彩灯，扩展版，外壳，投屏。
	第一个是一个网友移植的DLNA投屏客户端程序，它可以接收DLNA视频信息，并将其通过HDMI输出到显示器上进行显示，同时音频也支持传输。这个项目的亮点可不仅仅是支持了投屏上的传输，而是我们SDK有一个patch是更新了 gstreamer 的播放器的优化，这位网友直接自己魔改了gstreamer达到了使用硬件解码播放视频的效果，同时使用DLNA客户端来调用，播放了网上大或的badapple，效果十分流畅。
	这个是一个网友自行设计的哪吒扩展版的硬件。概括展板几乎使用到了哪吒的所有外设接口，包括扩展IO，红外，IIC，SPI，I2S等，其中板载的所有模块均调试成功上传在论坛中。
	这个D1实现的个人消息提醒器也是网友做的一个小demo，使用BOA实现的Web服务器，使用LVGL做的交互显示界面，可以定时提醒记忆设定注意事项。还可以通过外部触发的方式来进行提醒。
	这个是使用D1实现的4G简易热点NAS，通过和宇宙USB 接口网卡来进行上网，作者配置了Samba服服务器来进行文件传输和共享，同时开启了WIFI的热点模式，链接上共享的热点之后可以通过访问外网且能访问内存卡NAS。

上面这些都是网友的贡献，下面是我们自己的工作汇报。
  - 我的贡献
我在D1上做的移植贡献主要主要移植有 视频图像处理和外设驱动方便的库。在上面做了这些工作.......  做的现象级的东西所有 双屏异显，和卡牌识别的项目，以及后面的模块适配。
首先是ncnn的边缘推理，我使用哪吒进行拍照制作数据集，使用yolov5框架进行模型训练，同时使用模型转换工具进行模型的转换，将模型陈工部署在哪吒开发板上，在进行ncnn推理的过程中，有一些工具直接进行转化过程不支持的问题，需要自己手动删掉实现，详细过程我已将其开源记录，其中就包括不支持的过程的代码实现。

LVGL是一个开源显示框架，LVGL得益于其轻量级的占用和漂亮的主题UI赢得了广大开发者的喜爱，使用LVGL开发出了各式各样的漂亮UI，NXP公司为了方便GUI开发，也为其推出了 GUI Guider UI设计软件，可以帮助快速GUI开发，LVGL默认是使用cpu进行刷新的，默认的刷新使用 memcpy 来进行搬运，这里使用g2d 来进行块搬运，构建硬件加速，其中在编译的过程中需要使用固件编译出来的目录，参考在openwrt中的编译指令，进行库目录的包含，成功编译出来。
      
除此之外，我还为外设写了一些接口控制函数，这些接口可以使用宏定义来控制，同时也可以使用预定义的结构体来进行参数的设置和更改。同时I2C的接口使用了两种方法来封装，分别是C++de 类和C库，其中C均可支持I2C设备的读写，实现设备的控制，使用这些接口实现了OLED和IMU的驱动程序。

除了软件库之外，因为我们画PCB最熟悉最集成化的软件是 Altium Designer 我们虽然开源了原理图和封装库，但是对自己diy的开发者来说，AD的封装还是非常有必要的，我就参考我们的原理图制作了这个AD的原理图库和封装库。

同时使用我们的LEDC模块实现了控制灯带的流水样式，同时集成了颜色解码接口，可以直接从某钟前端页面中进行调色，然后将其颜色编码复制，调用点亮解码接口，就可以把颜色点亮在灯上，目前只写了三种流水样式，灯带可以玩出更多的花样。

除demo和模块之外，我还将过程制作文档，这些均是我在过程中踩的坑所整理记录出来的文档

这些以上就是我实习期间做的工作，接下来就是全职在线社区后续计划，同步其他博主资源的同时也要利用其他平台的资源，上传我们平台的资源和作品，同时照顾开发者们的开源作品作为主推，让其感受到我们社区的诚意，愿意将自己的经验上传至社区中，同时社区中正在更新的项目，也有带完成，





